<UserControl x:Class="WpfApp.Views.PedidosView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Status -->
            <RowDefinition Height="220"/>
            <!-- Pedidos salvos -->
            <RowDefinition Height="Auto"/>
            <!-- Pedido atual -->
            <RowDefinition Height="*"/>
            <!-- Itens -->
            <RowDefinition Height="Auto"/>
            <!-- Rodapé -->
        </Grid.RowDefinitions>

        <!-- STATUS -->
        <TextBlock Grid.Row="0"
                   Text="{Binding DebugStatus}"
                   Margin="0,0,0,6"/>

        <!-- PEDIDOS SALVOS -->
        <GroupBox Grid.Row="1" Header="Pedidos salvos" Padding="8" Margin="0,0,0,6">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Barra buscar -->
                <Grid Grid.Row="0" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Margin="0,0,8,0"
                             Text="{Binding FiltroPedidos, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Digite nome da pessoa ou Id do pedido"/>

                    <Button Grid.Column="1"
                            Content="Buscar"
                            Width="85"
                            Margin="0,0,8,0"
                            Command="{Binding BuscarPedidosCommand}"/>

                    <Button Grid.Column="2"
                            Content="Limpar"
                            Width="85"
                            Margin="0,0,8,0"
                            Command="{Binding LimparBuscaPedidosCommand}"/>

                    <Button Grid.Column="3"
                            Content="Atualizar"
                            Width="95"
                            Command="{Binding AtualizarPedidosCommand}"/>
                </Grid>

                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding PedidosSalvos}"
                          SelectedItem="{Binding PedidoSelecionadoSalvo, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          SelectionUnit="FullRow">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Id" Binding="{Binding Id}" Width="55"/>
                        <DataGridTextColumn Header="Data" Binding="{Binding DataVenda}" Width="150"/>
                        <DataGridTextColumn Header="Pessoa" Binding="{Binding Pessoa.Nome}" Width="140"/>
                        <DataGridTextColumn Header="Pagamento" Binding="{Binding FormaPagamento}" Width="110"/>
                        <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="90"/>

                        <!-- ✅ aqui aparece os produtos -->
                        <DataGridTextColumn Header="Produtos" Binding="{Binding ResumoProdutos}" Width="*"/>

                        <!-- ✅ aqui aparece o total -->
                        <DataGridTextColumn Header="Total" Binding="{Binding TotalPedidoTexto}" Width="90"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- PEDIDO (ATUAL) -->
        <GroupBox Grid.Row="2" Header="Pedido (atual)" Padding="8" Margin="0,0,0,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                    <TextBlock Text="Pessoa"/>
                    <ComboBox ItemsSource="{Binding Pessoas}"
                              SelectedItem="{Binding PessoaSelecionada}"
                              DisplayMemberPath="Nome"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="0,0,8,0">
                    <TextBlock Text="Forma de pagamento"/>
                    <ComboBox ItemsSource="{Binding FormasPagamento}"
                              SelectedItem="{Binding FormaPagamento}"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Vertical">
                    <Button Content="Recarregar"
                            Width="120"
                            Margin="0,18,0,6"
                            Command="{Binding RecarregarCombosCommand}"/>

                    <Button Content="Novo"
                            Width="120"
                            Margin="0,0,0,6"
                            Command="{Binding NovoPedidoCommand}"/>

                    <Button Content="Finalizar"
                            Width="120"
                            Command="{Binding FinalizarCommand}"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- ITENS -->
        <GroupBox Grid.Row="3" Header="Itens do Pedido" Padding="8" Margin="0,0,0,6">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Adição -->
                <Grid Grid.Row="0" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*"/>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="Produto"/>
                        <ComboBox ItemsSource="{Binding Produtos}"
                                  SelectedItem="{Binding ProdutoSelecionado}"
                                  DisplayMemberPath="Nome"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="0,0,8,0">
                        <TextBlock Text="Quantidade"/>
                        <TextBox Text="{Binding Quantidade, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <Button Grid.Column="2"
                            Content="Adicionar"
                            Width="90"
                            Margin="0,18,8,0"
                            Command="{Binding AdicionarItemCommand}"/>

                    <Button Grid.Column="3"
                            Content="Remover"
                            Width="90"
                            Margin="0,18,0,0"
                            Command="{Binding RemoverItemCommand}"/>
                </Grid>

                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding Itens}"
                          SelectedItem="{Binding ItemSelecionado}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Produto" Binding="{Binding Produto.Nome}" Width="*"/>
                        <DataGridTextColumn Header="Qtd" Binding="{Binding Quantidade}" Width="70"/>
                        <DataGridTextColumn Header="Valor Unit." Binding="{Binding Produto.Valor}" Width="110"/>
                        <DataGridTextColumn Header="Subtotal" Binding="{Binding Subtotal}" Width="110"/>
                    </DataGrid.Columns>
                </DataGrid>

                <TextBlock Grid.Row="2"
                           HorizontalAlignment="Right"
                           FontSize="16"
                           FontWeight="Bold"
                           Text="{Binding Total, StringFormat=Total: {0:C}}"/>
            </Grid>
        </GroupBox>

        <TextBlock Grid.Row="4"
                   Text="Dica: selecione um pedido salvo para visualizar os detalhes e itens."
                   HorizontalAlignment="Right"/>
    </Grid>
</UserControl>
